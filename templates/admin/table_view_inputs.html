{% extends "admin/change_list.html" %}
{% load static %}
{% block extrahead %}
    {{ form.media }}
    <script src="https://code.jquery.com/ui/1.14.1/jquery-ui.js"></script>
{% endblock %}
{% block content %}
    <div class="module">
        <form method="post" action="">
            <table id="result_list">
                <thead>
                    <tr>
                        {% for field in form %}
                        <th scope="col" class="column-id nowrap">
                            <div class="text">{{ field.label }}</div>
                        </th>
                        {% endfor %}
                    </tr>
                </thead>

            </table>

            {% csrf_token %}
            {% for i in range(10) %}
                {% for field in form %}
                    <div class="custom_input_block">
                        <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                        {{ field }}
                    </div>
                {% endfor %}
            {% endfor %}
        </form>
        <input type="submit" value="Добавить" class="default" />
        <div id="form-errors">
            {% for field in form %}
                {{ field.errors }}
            {% endfor %}
            {{ form.non_field_errors }}
        </div>
    </div>
    {{ block.super }}

    <script>
        $(function () {
            // Найти все элементы с классом single_line_add и применить автозаполнение
            $('.single_line_add').each(function() {
                const fieldElement = $(this);
                const fieldName = fieldElement.attr('name');
                const modelName = fieldElement.attr('model_name');
                fieldElement.autocomplete({
                    source: function(request, response) {
                        $.ajax({
                            url: '/autocomplete/',
                            dataType: "json",
                            data: {
                                term: request.term,
                                model_name: modelName,
                                field_name: fieldName
                            },
                            success: function(data) {
                                response(data);
                            }
                        });
                    },
                    minLength: 2
                });
            });
        });
    </script>
{% endblock %}
